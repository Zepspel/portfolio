---
title: "Logistic Regression"
author: "Ð¨Ð°Ñ†ÐºÐ¸Ñ… ÐŸ.Ðž."
date: "2025-11-27"
output: html_document
---

```{r}
dframe <- read.csv("https://hyper.mephi.ru/assets/courseware/v1/345e8b1c6ea11120575066ec4ac58f4a/asset-v1:MEPhIx+CS712DS+2025Fall+type@asset+block/survey.csv")

summary(dframe)
dframe$MYDEPV <- factor(dframe$MYDEPV)

dframe$intercept <- 1

dframe$price20 <- ifelse(dframe$Price == 20, 1, 0)

dframe$price30 <- ifelse(dframe$Price == 30, 1, 0)


model <- glm(MYDEPV ~ Income + Age + price20 + price30, dframe, family = binomial)

summary(model)
coef(model)
odds = exp(coef(model))
print(odds)
```

odds = P(1) / P(0)  
odds = P / (1-P)  
log(odds) = intercept + w1x1 + ... + wixi


## Income (Ð”Ð¾Ñ…Ð¾Ð´)  
ÐšÐ¾ÑÑ„Ñ„Ð¸Ñ†Ð¸ÐµÐ½Ñ‚: +0.12876  

Ð­Ñ„Ñ„ÐµÐºÑ‚: ÐŸÑ€Ð¸ ÑƒÐ²ÐµÐ»Ð¸Ñ‡ÐµÐ½Ð¸Ð¸ Ð´Ð¾Ñ…Ð¾Ð´Ð° Ð½Ð° 1 ÐµÐ´Ð¸Ð½Ð¸Ñ†Ñƒ, Ð»Ð¾Ð³Ð¸Ñ‚ Ð²ÐµÑ€Ð¾ÑÑ‚Ð½Ð¾ÑÑ‚Ð¸ Ñ†ÐµÐ»ÐµÐ²Ð¾Ð³Ð¾ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ñ ÑƒÐ²ÐµÐ»Ð¸Ñ‡Ð¸Ð²Ð°ÐµÑ‚ÑÑ Ð½Ð° 0.12876  

exp(0.12876) = 1.137 - odds = P/(1-P) ÑƒÐ²ÐµÐ»Ð¸Ñ‡Ð¸Ð²Ð°ÑŽÑ‚ÑÑ Ð² 1.137 Ñ€Ð°Ð·Ð° (Ð½Ð° 13.7%)  

Ð¡Ð¸Ð»ÑŒÐ½Ñ‹Ð¹ Ð¿Ð¾Ð»Ð¾Ð¶Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ð¹ ÑÑ„Ñ„ÐµÐºÑ‚  



## price30 (Ð¦ÐµÐ½Ð° = 30)
ÐšÐ¾ÑÑ„Ñ„Ð¸Ñ†Ð¸ÐµÐ½Ñ‚: -2.21028  

Ð­Ñ„Ñ„ÐµÐºÑ‚: Ð¡Ð¸Ð»ÑŒÐ½Ð¾Ðµ ÑƒÐ¼ÐµÐ½ÑŒÑˆÐµÐ½Ð¸Ðµ Ð»Ð¾Ð³Ð¸Ñ‚Ð° Ð²ÐµÑ€Ð¾ÑÑ‚Ð½Ð¾ÑÑ‚Ð¸ Ð¿Ñ€Ð¸ Ñ†ÐµÐ½Ðµ 30  

0.110 - odds ÑÐ¾ÑÑ‚Ð°Ð²Ð»ÑÑŽÑ‚ Ð²ÑÐµÐ³Ð¾ 11% Ð¾Ñ‚ Ð±Ð°Ð·Ð¾Ð²Ð¾Ð¹ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸  

ÐžÑ‡ÐµÐ½ÑŒ ÑÐ¸Ð»ÑŒÐ½Ñ‹Ð¹ Ð¾Ñ‚Ñ€Ð¸Ñ†Ð°Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ð¹ ÑÑ„Ñ„ÐµÐºÑ‚  


## Null Deviance (ÐÑƒÐ»ÐµÐ²Ð°Ñ Ð´ÐµÐ²Ð¸Ð°Ð½ÑÐ°)
1025.81 Ð½Ð° 749 ÑÑ‚ÐµÐ¿ÐµÐ½ÑÑ… ÑÐ²Ð¾Ð±Ð¾Ð´Ñ‹  

Ð­Ñ‚Ð¾ "Ð¿Ð»Ð¾Ñ…Ð¾ÑÑ‚ÑŒ" Ð¼Ð¾Ð´ÐµÐ»Ð¸, ÐºÐ¾Ñ‚Ð¾Ñ€Ð°Ñ Ð²ÐºÐ»ÑŽÑ‡Ð°ÐµÑ‚ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ intercept 

ÐŸÐ¾ÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÑ‚ Ð½Ð°ÑÐºÐ¾Ð»ÑŒÐºÐ¾ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð¾Ñ‚ÐºÐ»Ð¾Ð½ÑÑŽÑ‚ÑÑ Ð¾Ñ‚ Ð¿Ñ€Ð¾ÑÑ‚ÐµÐ¹ÑˆÐµÐ¹ Ð¼Ð¾Ð´ÐµÐ»Ð¸ (Ð²ÑÐµÐ³Ð´Ð° Ð¿Ñ€ÐµÐ´ÑÐºÐ°Ð·Ñ‹Ð²Ð°Ñ‚ÑŒ ÑÑ€ÐµÐ´Ð½ÐµÐµ)  

Ð§ÐµÐ¼ Ð±Ð¾Ð»ÑŒÑˆÐµ - Ñ‚ÐµÐ¼ Ñ…ÑƒÐ¶Ðµ Ð±Ð°Ð·Ð¾Ð²Ð°Ñ Ð¼Ð¾Ð´ÐµÐ»ÑŒ  

# ðŸ“‰ Residual Deviance (ÐžÑÑ‚Ð°Ñ‚Ð¾Ñ‡Ð½Ð°Ñ Ð´ÐµÐ²Ð¸Ð°Ð½ÑÐ°)
534.17 Ð½Ð° 745 ÑÑ‚ÐµÐ¿ÐµÐ½ÑÑ… ÑÐ²Ð¾Ð±Ð¾Ð´Ñ‹  

Ð­Ñ‚Ð¾ Ð¿Ð»Ð¾Ñ…Ð¾ÑÑ‚ÑŒ Ð¿Ð¾Ð»Ð½Ð¾Ð¹ Ð¼Ð¾Ð´ÐµÐ»Ð¸ (ÑÐ¾ Ð²ÑÐµÐ¼Ð¸ Ð¿Ñ€ÐµÐ´Ð¸ÐºÑ‚Ð¾Ñ€Ð°Ð¼Ð¸)  

ÐŸÐ¾ÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÑ‚ Ð½Ð°ÑÐºÐ¾Ð»ÑŒÐºÐ¾ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð¾Ñ‚ÐºÐ»Ð¾Ð½ÑÑŽÑ‚ÑÑ Ð¾Ñ‚ Ð²Ð°ÑˆÐµÐ¹ Ð¼Ð¾Ð´ÐµÐ»Ð¸  

Ð§ÐµÐ¼ Ð¼ÐµÐ½ÑŒÑˆÐµ - Ñ‚ÐµÐ¼ Ð»ÑƒÑ‡ÑˆÐµ  

1025.81 â†’ 534.17 = Ð£Ð¼ÐµÐ½ÑŒÑˆÐµÐ½Ð¸Ðµ Ð½Ð° 491.64  


## Ð¡Ñ‚ÐµÐ¿ÐµÐ½Ð¸ ÑÐ²Ð¾Ð±Ð¾Ð´Ñ‹ (degrees of freedom):
Null: 749 = 750 Ð½Ð°Ð±Ð»ÑŽÐ´ÐµÐ½Ð¸Ð¹ - 1 Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€ (intercept)  

Residual: 745 = 750 - 5 Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ð¾Ð² (intercept + 4 Ð¿Ñ€ÐµÐ´Ð¸ÐºÑ‚Ð¾Ñ€Ð°)  

## OÐ±ÑŠÑÑÐ½ÐµÐ½Ð¸Ðµ: ÐœÐ¾Ð´ÐµÐ»ÑŒ Ð¿Ñ€ÐµÐ´ÑÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÑ‚ Ð²ÐµÑ€Ð¾ÑÑ‚Ð½Ð¾ÑÑ‚ÑŒ Ð¿Ð¾ÐºÑƒÐ¿ÐºÐ¸/ÑÐ¿Ñ€Ð¾ÑÐ°, Ð³Ð´Ðµ:

Ð‘Ð¾Ð»ÐµÐµ Ð²Ñ‹ÑÐ¾ÐºÐ¸Ð¹ Ð´Ð¾Ñ…Ð¾Ð´ Ð¸ Ð²Ð¾Ð·Ñ€Ð°ÑÑ‚ ÑƒÐ²ÐµÐ»Ð¸Ñ‡Ð¸Ð²Ð°ÑŽÑ‚ Ð²ÐµÑ€Ð¾ÑÑ‚Ð½Ð¾ÑÑ‚ÑŒ  

Ð‘Ð¾Ð»ÐµÐµ Ð²Ñ‹ÑÐ¾ÐºÐ¸Ðµ Ñ†ÐµÐ½Ñ‹ Ð·Ð½Ð°Ñ‡Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ ÑƒÐ¼ÐµÐ½ÑŒÑˆÐ°ÑŽÑ‚ Ð²ÐµÑ€Ð¾ÑÑ‚Ð½Ð¾ÑÑ‚ÑŒ  

## Use our logistic regression model to make predictions on probability of success for each of the rows of data in the survey table. Add a column named odds_ratio to the survey table that calculates the odds-ratio of each row of data. Add another column to the survey table named prediction that uses the odds_ratio column data to solve for the probability of success for a row of data.

```{r}
dframe$pred <- predict(model, dframe, type = "response")

dframe$odds_ratio <- dframe$pred / (1 - dframe$pred)

dframe$prediction <- dframe$odds_ratio / (1 + dframe$odds_ratio)

head(dframe)
```

## d. Test the rule that the probability mass equals the counts.  Use the survey table and take the sums of the mydepv column and the prediction column.  Are the values equal? Excluding rounding errors, does probability mass equal count?
```{r}
count = sum(dframe$MYDEPV == 1)
print(count)
prob_mass = sum(dframe$pred)
print(prob_mass)
```

## e. Using the logistic model we have created, what is the likelihood of a person who is 25 years old with an income of $58,000 accepting an offer with a price of $20?

odds = P/(1-P)  
P = odds/(1+odds)  
odds = -6.021 + 0.129 * Income + 0.035 * Age - 0.744 * price20 - 2.210 * price30

```{r}
odds = exp(-6.021 + 0.129 * 58 + 0.035 * 25 - 0.744 * 1 - 2.210 * 0)
print(odds)
P = odds/(1+odds) 
print(P)
```

## Using the logistic model we have created, what is the likelihood of a person who is 40 years old with an income of $13761 accepting an offer with a price of $10?
```{r}
odds = exp(-6.021 + 0.129 * 13.761 + 0.035 * 40 - 0.744 * 0 - 2.210 * 0)
print(odds)
P = odds/(1+odds) 
print(P)
```